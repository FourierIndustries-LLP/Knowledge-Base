<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Transmit and Receive - FourierIndustries Knowledge Base</title><meta name="description" content="In this lesson, we will be learning how to send&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://knowledge.fourier.industries/transmit-and-receive.html"><link rel="alternate" type="application/atom+xml" href="https://knowledge.fourier.industries/feed.xml"><link rel="alternate" type="application/json" href="https://knowledge.fourier.industries/feed.json"><meta property="og:title" content="Transmit and Receive"><meta property="og:image" content="https://knowledge.fourier.industries/media/website/logo-3.png"><meta property="og:image:width" content="320"><meta property="og:image:height" content="100"><meta property="og:site_name" content="FourierIndustries Knowledge Base"><meta property="og:description" content="In this lesson, we will be learning how to send&hellip;"><meta property="og:url" content="https://knowledge.fourier.industries/transmit-and-receive.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://knowledge.fourier.industries/assets/css/style.css?v=681208164e31d2fcd496e0a5e392c48f"><link rel="stylesheet" href="https://knowledge.fourier.industries/assets/css/prism-dark.css?v=77202604b9c81e0cfc60210c4810d09c"><link rel="stylesheet" href="https://knowledge.fourier.industries/assets/css/photoswipe.css?v=58cff2621499ea4991c2685d7ff92200"><link rel="preconnect" href="https://62YTNPHZEM-dsn.algolia.net" crossorigin><link rel="stylesheet" href="https://knowledge.fourier.industries/assets/css/docsearch.css?v=5f509c0dccaf0aaffb9fc8c0b9e1351c"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://knowledge.fourier.industries/transmit-and-receive.html"},"headline":"Transmit and Receive","datePublished":"2022-04-08T14:33","dateModified":"2022-08-31T10:55","image":{"@type":"ImageObject","url":"https://knowledge.fourier.industries/media/website/logo-3.png","height":100,"width":320},"description":"In this lesson, we will be learning how to send&hellip;","author":{"@type":"Person","name":"Pan Ziyue","url":"https://knowledge.fourier.industries/authors/pan-ziyue/"},"publisher":{"@type":"Organization","name":"FourierIndustries LLP","logo":{"@type":"ImageObject","url":"https://knowledge.fourier.industries/media/website/logo-3.png","height":100,"width":320}}}</script><style>.pswp--svg .pswp__button,
				          .pswp--svg .pswp__button--arrow--left:before,
				          .pswp--svg .pswp__button--arrow--right:before {
					          background-image: url(https://knowledge.fourier.industries/assets/svg/gallery-icons-light.svg);
			              }</style></head><body><header class="header" id="js-header"><a class="logo" href="https://knowledge.fourier.industries/"><img src="https://knowledge.fourier.industries/media/website/logo-3.png" alt="FourierIndustries Knowledge Base"></a></header><main><div class="container container--with-sidebar"><div class="sidebar js-sidebar"><div class="sidebar__search"><div id="docsearch"></div></div><nav class="sidebar__menu"><ul class="js-sidebar-menu"><li class="has-submenu"><span>SSTuino Series</span><ul><li class="has-submenu"><span>SSTuino II</span><ul><li><a href="https://knowledge.fourier.industries/sstuino-innovators-kit-v2.html">Introduction</a></li><li><a href="https://knowledge.fourier.industries/sstuino-ii-essentials-track.html">Essentials Track</a></li><li><a href="https://knowledge.fourier.industries/frequently-asked-questions-faq-sstuino-ii.html">Frequently Asked Questions</a></li><li><a href="https://knowledge.fourier.industries/advanced-iot-track-2.html">Advanced Scientific Track</a></li><li><a href="https://knowledge.fourier.industries/advanced-iot-track.html">Advanced IoT Track</a></li><li><a href="https://knowledge.fourier.industries/advanced-iot-track-3.html">Advanced Actuators Track</a></li></ul></li><li class="has-submenu"><span>SSTuino Classic</span><ul><li><a href="https://knowledge.fourier.industries/home.html">Introduction</a></li><li><a href="https://knowledge.fourier.industries/home.html">Essentials Track</a></li></ul></li></ul></li><li class="has-submenu"><span>Exploring Further</span><ul><li><a href="https://knowledge.fourier.industries/work-in-progress.html">Sensors</a></li><li><a href="https://knowledge.fourier.industries/work-in-progress.html">Actuators</a></li></ul></li><li class="has-submenu"><span>Browse by Level</span><ul><li><a href="https://knowledge.fourier.industries/work-in-progress.html">Beginner</a></li><li><a href="https://knowledge.fourier.industries/work-in-progress.html">Intermediate</a></li><li><a href="https://knowledge.fourier.industries/work-in-progress.html">Advanced</a></li></ul></li></ul></nav></div><div class="content content--center"><article class="post"><h1>Transmit and Receive</h1><div class="post__entry"><p>In this lesson, we will be learning how to send and receive data to and from Ubidots. Let‚Äôs go!</p><div class="post__toc"><h3>Table of Contents</h3><ul><li><a href="#mcetoc_1g04lk9pg2bn">"Publishing" Data to Ubidots MQTT</a><ul><li><a href="#mcetoc_1g04lk9pg2bo">Arduino Hookup</a></li><li><a href="#mcetoc_1g04lk9pg2bp">Transplanting Code</a><ul><li><a href="#mcetoc_1g04lk9pg2bq">Step 1: Declaration</a></li><li><a href="#mcetoc_1g04lk9pg2br">Step 2: Setup</a></li><li><a href="#mcetoc_1g04lk9pg2bs">Step 3: Loop</a></li><li><a href="#mcetoc_1g04lk9pg2bt">Step 4: Publish</a></li></ul></li></ul></li><li><a href="#mcetoc_1g04lk9pg2bu">"Subscribing" data from Ubidots MQTT</a><ul><li><a href="#mcetoc_1g04lk9pg2bv">Ubidots Setup</a></li><li><a href="#mcetoc_1g04lk9pg2c0">Code</a><ul><li><a href="#mcetoc_1g04lk9pg2c1">Step 1: Declaration</a></li><li><a href="#mcetoc_1g04lk9pg2c2">Step 2:¬† Setup</a></li><li><a href="#mcetoc_1g04lk9pg2c3">Step 3: Loop</a></li><li><a href="#mcetoc_1g04lk9pg2c4">Step 4: Message Received</a></li><li><a href="#mcetoc_1g04lk9pg2c5">Step 5: Subscribe</a></li></ul></li></ul></li><li><a href="#mcetoc_1g04lk9pg2c6">Both at the same time!</a><ul><li><a href="#mcetoc_1g04lk9pg2c7">Arduino Hookup</a></li><li><a href="#mcetoc_1g04lk9pg2c8">Code</a><ul><li><a href="#mcetoc_1g04lk9pg2c9">Step 1: Declarations</a></li><li><a href="#mcetoc_1g04lk9pg2ca">Step 2: Setup</a></li><li><a href="#mcetoc_1g04lk9pg2cb">Step 3: Loop</a></li><li><a href="#mcetoc_1g04lk9pg2cc">Step 4: Message Received</a></li><li><a href="#mcetoc_1g04lk9pg2cd">Step 5: Subscribe</a></li></ul></li></ul></li><li><a href="#mcetoc_1g068rr6ph">In the next lesson...</a></li></ul></div><h2 id="mcetoc_1g04lk9pg2bn">"Publishing" Data to Ubidots MQTT</h2><p>Let us send (‚Äúpublish‚Äù) some data to Ubidots! We will be sending the ambient temperature to Ubidots with our TMP36 temperature sensor.</p><p>Open the previous Arduino code where we went through all the Wi-Fi passwords and Ubidots tokens (you should have saved it as ‚ÄúConnect‚Äù), and save it as a new project (name it something like ‚ÄúPublish‚Äù).</p><h3 id="mcetoc_1g04lk9pg2bo">Arduino Hookup</h3><figure class="post__image post__image--full"><img loading="lazy" src="https://knowledge.fourier.industries/media/posts/27/arduinoPot40.png" alt="" width="1837" height="854" sizes="(max-width: 749px) 100vw, 749px" srcset="https://knowledge.fourier.industries/media/posts/27/responsive/arduinoPot40-xs.png 300w, https://knowledge.fourier.industries/media/posts/27/responsive/arduinoPot40-sm.png 480w, https://knowledge.fourier.industries/media/posts/27/responsive/arduinoPot40-md.png 749w"></figure><p>You will need to connect your SSTuino according to the diagram above, with the TMP36 sensor's output connected to Analog In A0.</p><h3 id="mcetoc_1g04lk9pg2bp">Transplanting Code</h3><p>Now, let‚Äôs look at the TMP36 code that we built previously in TinkerCAD. It should look something like this:</p><pre><code class="language-cpp">// C++ code
//
int temp = 0;

void setup()
{
  pinMode(A0, INPUT);
  Serial.begin(9600);
}

void loop()
{
  temp = (-40 + 0.488155 * (analogRead(A0) - 20) + 0);
  Serial.println(temp);
  delay(10); // Delay a little bit to improve simulation performance
}</code></pre><p>Based on what we have learned in <a href="https://knowledge.fourier.industries/programming-the-sstuino-ii-5.html">From Blocks To Code - Part I</a>, we will be transplanting the 3 important sections of this code to the IoT template that we are using to connect: <strong>Declaration</strong>, <strong>Setup</strong> and <strong>Loop</strong>. Transplanting code is easy because the example has already marked out where to put your code üòÑ. Find the parts marked by <code>/********* This is where you put your own code *********/</code>.</p><h4 id="mcetoc_1g04lk9pg2bq">Step 1: Declaration</h4><p>The first part to transplant would be the variable <code>temp</code> for temperature so that we have this variable in our IoT code.</p><pre><code class="language-cpp">‚Ä¶
WiFiClient network;
MQTTClient client;

// declaration

/********* This is where you put your own code *********/

// Timer for multitasking. Default is 10000 ms (10 seconds)
RBD::Timer timer(10000);
int temp = 0;

/**************** End of your own code *****************/
‚Ä¶</code></pre><h4 id="mcetoc_1g04lk9pg2br">Step 2: Setup</h4><p><span style="font-weight: 400;">The second part would be our <code>setup()</code> function, to set Analog Pin A0 as an input. We can ignore the <code>Serial.begin</code> safely as we already set up our Serial connection in the example, so we only need to copy over <code>pinMode()</code>.</span></p><pre><code class="language-cpp">‚Ä¶
void setup()
{
  Serial.begin(9600);

  /********* This is where you put your own code *********/
    
  pinMode(A0, INPUT);
    
  /**************** End of your own code *****************/

  connectToWiFiAndMQTT(network, SECRET_SSID, SECRET_PASS, client, subscribe, messageReceived);
}
‚Ä¶</code></pre><h4 id="mcetoc_1g04lk9pg2bs">Step 3: Loop</h4><p>The third part is the <code>loop()</code> function, to calculate the temperature from the voltage. We only need to transplant the 1st line to our IoT example code, underneath <code>This is where you put your own code</code> and add a timer to only publish the value every 10 seconds. <code>timer.onRestart()</code> is the code used to check if the timer has reached 10 seconds, and also resets the timer once the time limit is reached.</p><pre><code class="language-cpp">‚Ä¶
void loop()
{
  connectionCheck(client, subscribe); // Check if connection is ok, must run on every loop

  /*
    If you need to publish data here, a publish is called 
    with a timer like this:

    if (timer.onRestart())
    {
      String dataString = String(data);
      publishUbidots(client, "topicName", dataString);
    }

    The value passed to publishUbidots must be a String
  */

  /********* This is where you put your own code *********/

  // Publish every 10 seconds
  if (timer.onRestart())
  {
    // Read the temperature
    temp = -40 + 0.488155 * (analogRead(A0) - 20);
  }

  /**************** End of your own code *****************/
}
‚Ä¶</code></pre><p>Great, now we are done with our transplanting and we are ready to write our first IoT code!</p><p>If you check out the file tab named <strong>‚Äòhelper.h‚Äô</strong>¬†on the tab bar, you will find that we have written a lot of functions to make your life easier. Here‚Äôs a rundown of all the functions that you can use throughout your IoT programs:</p><ul><li><code>connectToWiFi(SSID, password)</code>: Connects to Wi-Fi, and automatically reconnects if the Wi-Fi disconnects</li><li><code>publishUbidots(client, topic, message)</code>: Publishes an MQTT message on a topic</li><li><code>subscribeUbidots(client, topic)</code>: Subscribes to an MQTT topic. You should only use this function at the last part of the <code>connect()</code>¬†function</li><li><code>topicMatches(shortTopic, longTopic)</code>: Checks if your topic matches the topic sent by Ubidots</li><li><code>connect(client, subscribe)</code>: Connects to MQTT and automatically subscribes to topics designated in the <code>subscribe()</code> function</li></ul><p>Since MQTT only allows us to publish the data in the form of Strings, we need to convert our temperature number into a String. Make a new String variable called <code>temperatureString</code> with <code>temp</code> (recall lesson <a href="https://knowledge.fourier.industries/programming-the-sstuino-ii-5.html">From Blocks to Code - Part I</a>).</p><pre><code class="language-cpp">‚Ä¶
  temp = -40 + 0.488155 * (analogRead(A0) - 20);
    
  // Convert the temperature to a String
  String temperatureString = String(temp);
‚Ä¶
</code></pre><h4 id="mcetoc_1g04lk9pg2bt">Step 4: Publish</h4><p>Publishing to Ubidots using MQTT is as simple as calling the <code>publishUbidots()</code> function like so: <code>publishUbidots(client, ‚Äútemperature‚Äù, temperatureString);</code>.¬†</p><p>The code between the <code>/****/</code> in <code>loop()</code> should now look something like this:</p><pre><code class="language-cpp">‚Ä¶
void loop()<br>{
  ‚Ä¶

  /********* This is where you put your own code *********/

  // Publish every 10 seconds
  if (timer.onRestart())
  {
    // Read the temperature
    temp = -40 + 0.488155 * (analogRead(A0) - 20);
    
    // Convert the temperature to a String
    String temperatureString = String(temp);
    publishUbidots(client, "temperature", temperatureString);
  }

  /**************** End of your own code *****************/
}
‚Ä¶</code></pre><p>Before you upload your program, don't forget to double-check the 'arduino_secrets.h' file to ensure that you have the correct Wi-Fi password and Ubidots account details.</p><pre>Video coming soon! Thank you :) Use your finger to manually raise the temperature of the TMP36</pre><p>Connect your SSTuino, upload your program, open your Serial Monitor and go to your Ubidots dashboard. You can now see the current temperature on the dashboard!¬†</p><figure class="post__image post__image--center"><img loading="lazy" src="https://knowledge.fourier.industries/media/posts/27/Ubidots-5-Dashboard-7E.png" alt="" width="564" height="390" sizes="(max-width: 749px) 100vw, 749px" srcset="https://knowledge.fourier.industries/media/posts/27/responsive/Ubidots-5-Dashboard-7E-xs.png 300w, https://knowledge.fourier.industries/media/posts/27/responsive/Ubidots-5-Dashboard-7E-sm.png 480w, https://knowledge.fourier.industries/media/posts/27/responsive/Ubidots-5-Dashboard-7E-md.png 749w"></figure><p>Well done, now you have made your first Internet-connected temperature sensor in 4 steps (Declaration, Setup, Loop, Publish). This simple example can be extended to many other sensors that you may want to build, like motion detectors, air quality sensors, and so on.</p><h2 id="mcetoc_1g04lk9pg2bu">"Subscribing" data from Ubidots MQTT</h2><p>Now that we have sent, or ‚Äúpublished‚Äù data to Ubidots, let‚Äôs try receiving data by ‚Äúsubscribing‚Äù!¬†</p><p>We will be making a very simple example: a smart light switch. Arduino represents a HIGH signal with the number 1, and a LOW signal with the number 0, which means that we can simply represent the state of the light switch as 0s and 1s. Our light switch will use one of the debug lights on the board, meaning that you do not need to connect anything externally for it to work.</p><h3 id="mcetoc_1g04lk9pg2bv">Ubidots Setup</h3><p>Get started by creating a new Variable under your existing Device with the name ‚ÄúLight‚Äù as shown:</p><figure class="post__image post__image--center"><img loading="lazy" src="https://knowledge.fourier.industries/media/posts/27/Ubidots-6-Subscribe-1E.png" alt="" width="662" height="452" sizes="(max-width: 749px) 100vw, 749px" srcset="https://knowledge.fourier.industries/media/posts/27/responsive/Ubidots-6-Subscribe-1E-xs.png 300w, https://knowledge.fourier.industries/media/posts/27/responsive/Ubidots-6-Subscribe-1E-sm.png 480w, https://knowledge.fourier.industries/media/posts/27/responsive/Ubidots-6-Subscribe-1E-md.png 749w"></figure><p>Next, let‚Äôs create a switch on our dashboard so that we can control this light switch. Press the + button on top and create a new switch, then link it to the ‚ÄúLight‚Äù Variable of your device.</p><div class="gallery-wrapper"><div class="gallery" data-is-empty="false" data-translation="Add images" data-columns="3"><figure class="gallery__item"><a href="https://knowledge.fourier.industries/media/posts/27/gallery/Ubidots-6-Subscribe-2.png" data-size="2134x1474"><img loading="lazy" src="https://knowledge.fourier.industries/media/posts/27/gallery/Ubidots-6-Subscribe-2-thumbnail.png" alt="" width="749" height="517"></a><figcaption>Select 'Switch' to add to your dashboard</figcaption></figure><figure class="gallery__item"><a href="https://knowledge.fourier.industries/media/posts/27/gallery/Ubidots-6-Subscribe-3.png" data-size="2136x1478"><img loading="lazy" src="https://knowledge.fourier.industries/media/posts/27/gallery/Ubidots-6-Subscribe-3-thumbnail.png" alt="" width="749" height="518"></a><figcaption>Add the Variable called "light"</figcaption></figure><figure class="gallery__item"><a href="https://knowledge.fourier.industries/media/posts/27/gallery/Ubidots-6-Subscribe-4.png" data-size="1208x838"><img loading="lazy" src="https://knowledge.fourier.industries/media/posts/27/gallery/Ubidots-6-Subscribe-4-thumbnail.png" alt="" width="749" height="520"></a><figcaption>Done!</figcaption></figure></div></div><p>We are now done with Ubidots.</p><h3 id="mcetoc_1g04lk9pg2c0">Code</h3><p>We can open the code that we used to connect to MQTT previously (should be named Connect) and save it as a new project (name it something like ‚ÄúSubscribe‚Äù). You can also open the Publish code you just built as a side-by-side reference if you need to.</p><p>We can now start building our code for subscribing with 5 major steps: <strong>Declaration</strong>, <strong>Setup</strong>, <strong>Loop</strong>, <strong>Message Received</strong> and <strong>Subscribe</strong>. Compared to the previous Publish example, it has 1 extra and 1 changed step.</p><h4 id="mcetoc_1g04lk9pg2c1">Step 1: Declaration</h4><p>You will first need to store the state of the light, in other words, whether it is on or off (in Arduino terms, <code>HIGH</code> or <code>LOW</code>). Make an integer variable called <code>light</code> and set it to <code>LOW</code> initially.</p><pre><code class="language-cpp">‚Ä¶
WiFiClient network;
MQTTClient client;

/********* This is where you put your own code *********/

// Timer for multitasking. Default is 10000 ms (10 seconds)
RBD::Timer timer(10000);

// Variables
int light = LOW;

/**************** End of your own code *****************/

void setup()
‚Ä¶</code></pre><h4 id="mcetoc_1g04lk9pg2c2">Step 2:¬† Setup</h4><p>In our setup, we need to tell our SSTuino that the pin that we want our light to be an output. We will use Pin 2 in our case as it‚Äôs the first pin with an LED. Use <code>pinMode</code> to set Pin 2 as an output.</p><pre><code class="language-cpp">‚Ä¶
void setup()<br>{
  Serial.begin(9600);

  /********* This is where you put your own code *********/

  pinMode(2, OUTPUT);

  /**************** End of your own code *****************/

  connectToWiFiAndMQTT(network, SECRET_SSID, SECRET_PASS, client, subscribe, messageReceived);
}
‚Ä¶</code></pre><h4 id="mcetoc_1g04lk9pg2c3">Step 3: Loop</h4><p>Inside the loop, we have to respond to changes to the <code>light</code> variable by properly toggling the light on pin 2 on or off. Whenever a message from the subscribed topic comes in, another function will change the <code>light</code> variable, and over here, we need to ‚Äúapply‚Äù this change by actually using the <code>digitalWrite()</code> function.</p><pre><code class="language-cpp">‚Ä¶
void loop()
{
  ‚Ä¶

  /********* This is where you put your own code *********/

  digitalWrite(2, light);

  /**************** End of your own code *****************/
}
‚Ä¶</code></pre><h4 id="mcetoc_1g04lk9pg2c4">Step 4: Message Received</h4><p>Inside this special function is where the MQTT subscribe message is actually received. We have to check if it‚Äôs really the correct message by checking the topic, and then changing the value of <code>light</code> based on the value received.¬†</p><p>We do this check by using the <code>topicMatches(shortTopic, longTopic)</code> helper function, which breaks down Ubidot‚Äôs long and hard-to-understand topic format of <code>/v1.6/devices/{API LABEL}/{VARIABLE}/lv</code> into just <code>{VARIABLE}</code>.</p><p>If the topic is the one we want (i.e. outcome of this function is <code>true</code>), we will change the <code>light</code> variable based on the payload of the message. To do that, we have to convert the payload from a String to an integer. Recall the <a href="https://knowledge.fourier.industries/programming-the-sstuino-ii-5.html">From Blocks to Code lesson</a>, where we converted data from one type to another. To convert a String to int, we just need to use <code>.toInt()</code> behind the String!</p><pre><code class="language-cpp">‚Ä¶
void messageReceived(String &amp;topic, String &amp;payload)
{
  Serial.println("Incoming data: " + topic + " - " + payload);

  /*
    All the messages your MQTT service receives can be
    loaded here. You should check if the message is the
    correct topic and convert the message from String
    to the data type you need

    For example:
    if (topicMatches("light", topic) == true)
    {
      light = payload.toInt(); // convert incoming message from String to int
    }

    *NOTE*: Do not use this function to publish, subscribe
    or unsubscribe as it may cause deadlocks
  */

  /********* This is where you put your own code *********/

  if (topicMatches("light", topic) == true)
  {
    // You can do something with the payload, which is a String
    light = payload.toInt(); // convert the incoming message from String to int
  }

  /**************** End of your own code *****************/
}
‚Ä¶</code></pre><h4 id="mcetoc_1g04lk9pg2c5">Step 5: Subscribe</h4><p>At long last, we have come to the last part we have to change: the <code>subscribe()</code> function. This function is responsible for subscribing to the topics that we want to receive messages from.¬†</p><p>Simply call the <code>subscribeUbidots()</code> function from the helper by coding <code>subscribeUbidots(client, "light");</code> and you‚Äôre done!</p><pre><code class="language-cpp">‚Ä¶
void subscribe()
{
  /*
    For example, a subscribe is called like:
    subscribeUbidots(client, "light");
  */
 
  /********* This is where you put your own code *********/

  subscribeUbidots(client, "light");

  /**************** End of your own code *****************/
}
‚Ä¶</code></pre><p>All 5 steps are done now, so it‚Äôs time to run your project. Plug in your SSTuino, upload this code, open the Serial Monitor and let it connect. Once it is fully connected, you can try press the switch on your Ubidots dashboard to see the LED on Pin 2 light up!</p><pre>Video coming soon! :) Simply press switch on Ubidots and pin 2 should light up</pre><h2 id="mcetoc_1g04lk9pg2c6">Both at the same time!</h2><p>Now that we have both Publish and Subscribe, let's try to do both at the same time. Use the Save As function to make a copy of your "Publish" project and name it "Both". Keep the Subscribe project on one side of your screen so that you can always refer to it.¬†</p><h3 id="mcetoc_1g04lk9pg2c7">Arduino Hookup</h3><p>This practise will use the exact same circuit as the Publish example.</p><figure class="post__image post__image--full"><img loading="lazy" src="https://knowledge.fourier.industries/media/posts/27/arduinoPot40.png" alt="" width="1837" height="854" sizes="(max-width: 749px) 100vw, 749px" srcset="https://knowledge.fourier.industries/media/posts/27/responsive/arduinoPot40-xs.png 300w, https://knowledge.fourier.industries/media/posts/27/responsive/arduinoPot40-sm.png 480w, https://knowledge.fourier.industries/media/posts/27/responsive/arduinoPot40-md.png 749w"></figure><h3 id="mcetoc_1g04lk9pg2c8">Code</h3><p>We are going to walk through this tutorial the same way as we did for Subscribe, which is to break it down into 5 steps: <strong>Declaration</strong>, <strong>Setup</strong>, <strong>Loop</strong>, <strong>Message Received</strong> and <strong>Subscribe</strong>.</p><p>In addition, as our program is now time-sensitive, we will need to multitask our Arduino! To make things simpler, a 10 second (10000 millisecond) timer has already been created for you with the line of code <code style="font-weight: var(--font-weight-normal);">RBD::Timer timer(10000);</code><span style="color: var(--text-primary-color); font-family: var(--editor-font-family); font-size: inherit; font-weight: var(--font-weight-normal);">.</span></p><h4 id="mcetoc_1g04lk9pg2c9">Step 1: Declarations</h4><p>Firstly, you want to merge the variables at the top of the code above <code>setup()</code>, having both <code>temp</code> and <code>light</code>¬†for temperature and light switch respectively.</p><pre><code class="language-cpp">‚Ä¶
WiFiClient network;
MQTTClient client;

// declaration

/********* This is where you put your own code *********/

// Variables
int temp = 0;
int light = LOW;

// Timer for multitasking. Default is 10000 ms (10 seconds)
RBD::Timer timer(10000);

/**************** End of your own code *****************/
‚Ä¶</code></pre><h4 id="mcetoc_1g04lk9pg2ca">Step 2: Setup</h4><p>Next, within the <code>setup()</code>¬†function, add another function call to <code>pinMode</code> so that you designate Pin 2 (the same pin that we used in our Subscribe example) as an output pin.¬†</p><pre><code class="language-cpp">‚Ä¶
void setup()
{
  Serial.begin(9600);

  /********* This is where you put your own code *********/

  pinMode(A0, INPUT);
  pinMode(2, OUTPUT);

  /**************** End of your own code *****************/

  connectToWiFiAndMQTT(network, SECRET_SSID, SECRET_PASS, client, subscribe, messageReceived);
}
‚Ä¶</code></pre><h4 id="mcetoc_1g04lk9pg2cb">Step 3: Loop</h4><p>Within the <code>loop()</code> function, we have to periodically set Pin 2‚Äôs signal to be on/off, depending on what the variable <code>light</code>¬†is at the moment. We will do this with a <code>digitalWrite(2, light)</code>.</p><p>Notice how that the <code>digitalWrite</code> function is outside the <code>if (timer.onRestart())</code> brackets that are responsible for checking if the delay time has passed, which means that it will be called every single time when the loop is run, instead of every 10 seconds.</p><p>Here's the code for the <code>loop()</code> function in full:</p><pre><code class="language-cpp">‚Ä¶
void loop()
{
  connectionCheck(client, subscribe); // Check if connection is ok, must run on every loop

  /*
    ‚Ä¶
  */

  /********* This is where you put your own code *********/

  // Publish every 10 seconds
  if (timer.onRestart())
  {
    // Read the temperature
    temp = -40 + 0.488155 * (analogRead(A0) - 20);

    // Convert the temperature to a String
    String temperatureString = String(temp);
    publishUbidots(client, "temperature", temperatureString);
  }

  digitalWrite(2, light);

  /**************** End of your own code *****************/
}
‚Ä¶</code></pre><h4 id="mcetoc_1g04lk9pg2cc">Step 4: Message Received</h4><p>In the <code>messageReceived()</code> function, we have to check for our incoming message just like what we did previously. Copy from the beginning to the end of the if statement and paste it between <code>This is where you put our code</code> markers.</p><pre><code class="language-cpp">‚Ä¶
void messageReceived(String &amp;topic, String &amp;payload)
{
  Serial.println("Incoming data: " + topic + " - " + payload);

  /*
    ‚Ä¶
  */

  /********* This is where you put your own code *********/

  if (topicMatches("light", topic) == true)
  {
    // You can do something with the payload, which is a String
    light = payload.toInt(); // convert the incoming message from String to int
  }

  /**************** End of your own code *****************/
}
‚Ä¶</code></pre><h4 id="mcetoc_1g04lk9pg2cd">Step 5: Subscribe</h4><p>Finally, don‚Äôt forget to actually subscribe to the topic in question, which should be named <code>light</code>, in the <code>subscribe()</code> function.</p><pre><code class="language-cpp">‚Ä¶
void subscribe()
{
  /*
    For example, a subscribe is called like:
    subscribeUbidots(client, "light");
  */
 
  /********* This is where you put your own code *********/

  subscribeUbidots(client, "light");

  /**************** End of your own code *****************/
}
‚Ä¶</code></pre><p>With all of the code done, it‚Äôs time to plug in your SSTuino and upload the code. Try playing around with the switch on your dashboard to see if the debug LED on Pin 2 turns on and off.</p><pre>Video coming soon! Thank you :)</pre><p>If everything works out, awesome! You have successfully made an IoT controller for a smart home, with a temperature sensor to tell you how hot or cold your room is, and an internet-controlled light that you can trigger using other Internet controlled functions. You can explore how to integrate this with IFTTT (If This Then That) or other smart solutions to link your existing devices like a Google Home Mini with your SSTuino based IoT controller.¬†</p><h2 id="mcetoc_1g068rr6ph">In the next lesson...</h2><p>In our next two tutorials, we will be building a mobile app with Thunkable, a ‚Äúcode-lite‚Äù mobile app creator. It is <strong>highly recommended</strong> that you watch some of Thunkable‚Äôs tutorials at home, as well as try out the next tutorial (<a href="https://knowledge.fourier.industries/mobile-apps-part-1.html">Mobile Apps, Part 1</a>). All of these videos are bite-sized, 1-2 minute videos so it‚Äôs really quick to get up to speed with how Thunkable works! The next tutorial will only cover a shortened version to get you up to speed.</p><p><strong>Essential Tutorials:</strong></p><ol><li><a href="https://www.youtube.com/watch?v=dQQsvQr-f1U">Introduction to Drag and Drop</a></li><li><a href="https://www.youtube.com/watch?v=0NrkKiCGaxk">Build a Translator App with Thunkable</a></li><li><a href="https://www.youtube.com/watch?v=TqIVHGYdi54">How Screens and Navigation works in Thunkable</a></li><li><a href="https://www.youtube.com/watch?v=3M9F3X1bCnA">Using App Variables</a></li><li><a href="https://www.youtube.com/watch?v=3jS3F3IRQB0">Using Functions</a></li></ol><p><strong>Optional Tutorials:</strong></p><ol><li><a href="https://www.youtube.com/watch?v=qotZVqzTUpg">Using Logic Blocks</a></li><li><a href="https://www.youtube.com/watch?v=FxrXdZPRTLw">Understanding Web (HTTP) APIs in Thunkable</a></li></ol><p><a href="https://knowledge.fourier.industries/getting-started-with-iot.html" class="btn btn--outline">‚¨ÖÔ∏è Back</a><a style="float: right;" href="https://knowledge.fourier.industries/mobile-apps-part-1.html" class="btn btn--green">Next ‚û°Ô∏è</a></p></div></article></div></div></main><footer class="footer"><div><a class="footer__logo" href="https://knowledge.fourier.industries/"><img src="https://knowledge.fourier.industries/media/website/logo-3.png" alt="FourierIndustries Knowledge Base"></a><ul class="footer__nav"><li><a href="https://fourier.industries">Homepage</a></li><li><a href="https://knowledge.fourier.industries/terms-of-service.html">Terms of Service</a></li><li><a href="https://knowledge.fourier.industries/contact-us.html">Contact Us</a></li></ul></div><div><div class="footer__copy">Copyright ¬© FourierIndustries LLP | Powered by Publii</div><div class="footer__social"></div></div></footer><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'overlay',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true
   };</script><script defer="defer" src="https://knowledge.fourier.industries/assets/js/scripts.min.js?v=19238bf2fc84904070fcd40cc63434e6"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://knowledge.fourier.industries/assets/js/prism.js?v=3f40a85448916137440d70109f6ef21e"></script><script defer="defer" src="https://knowledge.fourier.industries/assets/js/prism-line-numbers.min.js?v=13275d3ac10d7028cf6a6f5da276f68c"></script><script defer="defer" src="https://knowledge.fourier.industries/assets/js/clipboard.min.js?v=ad98572d415d2f2452845a6068a913c0"></script><script defer="defer" src="https://knowledge.fourier.industries/assets/js/prism-copy-to-clipboard.min.js?v=57b50bd6f44169b9bab177133c984653"></script><script src="https://knowledge.fourier.industries/assets/js/docsearch.min.js?v=d59ba9b8392f352d8127a805b3df99b9"></script><script>docsearch({
         container: '#docsearch',
         appId: '62YTNPHZEM',
         indexName: 'knowledge-fourier',
         apiKey: '097a668efc489587eb7c5ca95081083d',
         debug: false
      });</script><script defer="defer" src="https://knowledge.fourier.industries/assets/js/photoswipe.min.js?v=017385b552f7e0d979e2e2fe6f324015"></script><script defer="defer" src="https://knowledge.fourier.industries/assets/js/photoswipe-ui-default.min.js?v=d067f0883540b1ddda0e2c9ad1b14260"></script><script>var initPhotoSwipeFromDOM=function(gallerySelector){var parseThumbnailElements=function(el){var thumbElements=el.childNodes,numNodes=thumbElements.length,items=[],figureEl,linkEl,size,item;for(var i=0;i<numNodes;i++){figureEl=thumbElements[i];if(figureEl.nodeType!==1){continue;}
          linkEl=figureEl.children[0];size=linkEl.getAttribute('data-size').split('x');item={src:linkEl.getAttribute('href'),w:parseInt(size[0],10),h:parseInt(size[1],10)};if(figureEl.children.length>1){item.title=figureEl.children[1].innerHTML;}
          if(linkEl.children.length>0){item.msrc=linkEl.children[0].getAttribute('src');}
          item.el=figureEl;items.push(item);}
          return items;};var closest=function closest(el,fn){return el&&(fn(el)?el:closest(el.parentNode,fn));};var onThumbnailsClick=function(e){e=e||window.event;e.preventDefault?e.preventDefault():e.returnValue=false;var eTarget=e.target||e.srcElement;var clickedListItem=closest(eTarget,function(el){return(el.tagName&&el.tagName.toUpperCase()==='FIGURE');});if(!clickedListItem){return;}
          var clickedGallery=clickedListItem.parentNode,childNodes=clickedListItem.parentNode.childNodes,numChildNodes=childNodes.length,nodeIndex=0,index;for(var i=0;i<numChildNodes;i++){if(childNodes[i].nodeType!==1){continue;}
          if(childNodes[i]===clickedListItem){index=nodeIndex;break;}
          nodeIndex++;}
          if(index>=0){openPhotoSwipe(index,clickedGallery);}
          return false;};var photoswipeParseHash=function(){var hash=window.location.hash.substring(1),params={};if(hash.length<5){return params;}
          var vars=hash.split('&');for(var i=0;i<vars.length;i++){if(!vars[i]){continue;}
          var pair=vars[i].split('=');if(pair.length<2){continue;}
          params[pair[0]]=pair[1];}
          if(params.gid){params.gid=parseInt(params.gid,10);}
          return params;};var openPhotoSwipe=function(index,galleryElement,disableAnimation,fromURL){var pswpElement=document.querySelectorAll('.pswp')[0],gallery,options,items;items=parseThumbnailElements(galleryElement);options={galleryUID:galleryElement.getAttribute('data-pswp-uid'),getThumbBoundsFn:function(index){var thumbnail=items[index].el.getElementsByTagName('img')[0],pageYScroll=window.pageYOffset||document.documentElement.scrollTop,rect=thumbnail.getBoundingClientRect();return{x:rect.left,y:rect.top+pageYScroll,w:rect.width};},
          mainClass:'pswp--dark',
          preload: [1,2],
          hideAnimationDuration:200,
          showAnimationDuration:0,
          bgOpacity: 0.7,
          showHideOpacity:true,
          closeOnScroll: true,
          arrowKeys: true,
          closeEl: true,
          captionEl: true,
          fullscreenEl: true,
          zoomEl: true,
          shareEl: true,
          counterEl: true,
          arrowEl: true,
          preloaderEl: true
          };if(fromURL){if(options.galleryPIDs){for(var j=0;j<items.length;j++){if(items[j].pid==index){options.index=j;break;}}}else{options.index=parseInt(index,10)-1;}}else{options.index=parseInt(index,10);}
          if(isNaN(options.index)){return;}
          if(disableAnimation){options.showAnimationDuration=0;}
          gallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,items,options);gallery.init();gallery.options.escKey=true;};var galleryElements=document.querySelectorAll(gallerySelector);for(var i=0,l=galleryElements.length;i<l;i++){galleryElements[i].setAttribute('data-pswp-uid',i+1);galleryElements[i].onclick=onThumbnailsClick;}
          var hashData=photoswipeParseHash();if(hashData.pid&&hashData.gid){openPhotoSwipe(hashData.pid,galleryElements[hashData.gid-1],true,true);}};window.addEventListener('load', function () {initPhotoSwipeFromDOM('.gallery');}, false);</script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><button class="pswp__button pswp__button--share" title="Share"></button><button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button><button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button><button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></body></html>